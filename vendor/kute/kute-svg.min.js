!function(t,e){if("function"==typeof define&&define.amd)define(["./kute.js"],e);else if("object"==typeof module&&"function"==typeof require)module.exports=e(require("./kute.js"));else{if(void 0===t.KUTE)throw new Error("SVG Plugin require KUTE.js.");e(t.KUTE)}}(this,function(t){"use strict";var e="undefined"!=typeof global?global:window,r=t,n=r.dom,a=r.parseProperty,s=r.prepareStart,o=r.getCurrentStyle,i=(r.truC,r.truD,r.crossCheck),v=e.Interpolate.number,l=(e.Interpolate.unit,e.Interpolate.color,r.defaultOptions),h=null!==new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)&&parseFloat(RegExp.$1);if(!(h&&h<9)){var u=/(m[^(h|v|l)]*|[vhl][^(v|h|l|z)]*)/gim,p=e.Interpolate.coords=function(t,e,r,n){for(var a=[],s=0;s<r;s++){a[s]=[];for(var i=0;i<2;i++)a[s].push((1e3*(t[s][i]+(e[s][i]-t[s][i])*n)>>0)/1e3)}return a},m=function(t,e,r){for(var n,a,s,i,o,l=[],h=r.length,u=0;u<h;u++)n=Math.abs(r[u][0]-e.x),a=Math.abs(r[u][1]-e.y),l.push(Math.sqrt(n*n+a*a));return o=r[(s=l.indexOf(Math.min.apply(null,l)))-1]?s-1:h-1,i=r[s+1]?s+1:0,Math.abs(r[o][0]-e.x)<t&&Math.abs(r[o][1]-e.y)<t?r[o]:Math.abs(r[i][0]-e.x)<t&&Math.abs(r[i][1]-e.y)<t?r[i]:Math.abs(r[s][0]-e.x)<t&&Math.abs(r[s][1]-e.y)<t?r[s]:[e.x,e.y]},d=function(t){for(var e,r,n=t.match(u),a=n.length,s=0,i=0,o=0;o<a;o++)n[o]=n[o],e=n[o][0],r=new RegExp(e+"[^\\d|\\-]*","i"),n[o]=n[o].replace(/(^|[^,])\s*-/g,"$1,-").replace(/(\s+\,|\s|\,)/g,",").replace(r,"").split(","),n[o][0]=parseFloat(n[o][0]),n[o][1]=parseFloat(n[o][1]),0===o?(s+=n[o][0],i+=n[o][1]):(s=n[o-1][0],i=n[o-1][1],/l/i.test(e)?(n[o][0]="l"===e?n[o][0]+s:n[o][0],n[o][1]="l"===e?n[o][1]+i:n[o][1]):/h/i.test(e)?(n[o][0]="h"===e?n[o][0]+s:n[o][0],n[o][1]=i):/v/i.test(e)&&(n[o][0]=s,n[o][1]="v"===e?n[o][0]+i:n[o][0]));return n},g=function(t){return t.split(/z/i).shift()+"z"},y=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","path"),r="object"==typeof t?t.getAttribute("d"):t;return e.setAttribute("d",r),e},f=function(t){var e={},r="object"==typeof t?t:/^\.|^\#/.test(t)?document.querySelector(t):null;return r&&/path|glyph/.test(r.tagName)?(e.e=function(t){if("glyph"!==t.tagName)return t;var e=y(t);return t.parentNode.appendChild(e),e}(r),e.o=r.getAttribute("d")):!r&&/[a-z][^a-z]*/gi.test(t)&&(e.e=y(t.trim()),e.o=t),e},c=function(t,e){var r,n,a,s,i,o,l,h,u,p,g=[],f=this.options.morphIndex;if(this._isPolygon)if(t=d(t),e=d(e),t.length!==e.length){o=(s=Math.max(t.length,e.length))===e.length?(i=t,e):(i=e,t),i.length,h=(l=y("M"+i.join("L")+"z")).getTotalLength()/s;for(var c=0;c<s;c++)u=l.getPointAtLength(h*c),p=m(h,u,i),g.push([p[0],p[1]]);s===e.length?(n=o,r=g):(r=o,n=g)}else r=t,n=e;else r=(a=function(t,e,r){for(var n=[],a=[],s=t.getTotalLength(),i=e.getTotalLength(),o=0,l=Math.max(s,i)/r*r;(o+=r)<l;)n.push([t.getPointAtLength(o).x,t.getPointAtLength(o).y]),a.push([e.getPointAtLength(o).x,e.getPointAtLength(o).y]);return[n,a]}(t=y(t),e=y(e),this.options.morphPrecision))[0],s=(n=a[1]).length;(this.options.reverseFirstPath&&r.reverse(),this.options.reverseSecondPath&&n.reverse(),f)&&(n=n.splice(f,s-f).concat(n));return t=e=null,[r,n]};l.morphPrecision=15,a.path=function(t,e){return"path"in n||(n.path=function(t,e,r,n,a){t.setAttribute("d",1===a?n.o:"M"+p(r.d,n.d,n.d.length,a)+"Z")}),f(e)},s.path=function(t){return this.element.getAttribute("d")},i.path=function(){var t,e=g(this.valuesStart.path.o),r=g(this.valuesEnd.path.o);this.options.morphPrecision=this.options&&"morphPrecision"in this.options?parseInt(this.options.morphPrecision):l.morphPrecision,this._isPolygon=!/[CSQTA]/i.test(e)&&!/[CSQTA]/i.test(r),t=c.apply(this,[e,r]),this.valuesStart.path.d=t[0],this.valuesEnd.path.d=t[1]};var b=function(t,e){return parseFloat(t)/100*e},w=function(t){return/rect/.test(t.tagName)?2*(u=t).getAttribute("width")+2*u.getAttribute("height"):/circle/.test(t.tagName)?(h=t.getAttribute("r"),2*Math.PI*h):/ellipse/.test(t.tagName)?(o=2*(i=t).getAttribute("rx"),l=2*i.getAttribute("ry"),Math.sqrt(.5*(o*o+l*l))*(2*Math.PI)/2):/polygon|polyline/.test(t.tagName)?function(t){var e=t.getAttribute("points").split(" "),r=0;if(1<e.length){var n=function(t){var e=t.split(",");if(2==e.length&&!isNaN(e[0])&&!isNaN(e[1]))return[parseFloat(e[0]),parseFloat(e[1])]},a=function(t,e){return null!=t&&null!=e?Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)):0};if(2<e.length)for(var s=0;s<e.length-1;s++)r+=a(n(e[s]),n(e[s+1]));r+="polygon"===t.tagName?a(n(e[0]),n(e[e.length-1])):0}return r}(t):/line/.test(t.tagName)?(r=(e=t).getAttribute("x1"),n=e.getAttribute("x2"),a=e.getAttribute("y1"),s=e.getAttribute("y2"),Math.sqrt(Math.pow(n-r,2)+Math.pow(s-a,2))):void 0;var e,r,n,a,s,i,o,l,h,u},A=function(t,e){var r,n,a,s,i=/path|glyph/.test(t.tagName)?t.getTotalLength():w(t);return e instanceof Object?e:("string"==typeof e?(e=e.split(/\,|\s/),r=/%/.test(e[0])?b(e[0].trim(),i):parseFloat(e[0]),n=/%/.test(e[1])?b(e[1].trim(),i):parseFloat(e[1])):void 0===e&&(s=parseFloat(o(t,"stroke-dashoffset")),a=o(t,"stroke-dasharray").split(/\,/),r=0-s,n=parseFloat(a[0])+r||i),{s:r,e:n,l:i})};a.draw=function(t,e){return"draw"in n||(n.draw=function(t,e,r,n,a){var s=(100*r.l>>0)/100,i=0-(100*v(r.s,n.s,a)>>0)/100,o=(100*v(r.e,n.e,a)>>0)/100+i;t.style.strokeDashoffset=i+"px",t.style.strokeDasharray=(100*(o<1?0:o)>>0)/100+"px, "+s+"px"}),A(this.element,e)},s.draw=function(){return A(this.element)};var M=function(t,e){return/[a-zA-Z]/.test(t)&&!/px/.test(t)?t.replace(/top|left/,0).replace(/right|bottom/,100).replace(/center|middle/,50):/%/.test(t)?e.x+parseFloat(t)*e.width/100:parseFloat(t)},x=function(t){var e=t&&/\)/.test(t)?t.substring(0,t.length-1).split(/\)\s|\)/):"none",r={};if(e instanceof Array)for(var n=0,a=e.length;n<a;n++){var s=e[n].trim().split("(");r[s[0]]=s[1]}return r},k=function(t){var e,r={},n=this.element.getBBox(),a=n.x+n.width/2,s=n.y+n.height/2,i=this.options.transformOrigin;for(var o in(i=i?i instanceof Array?i:i.split(/\s/):[a,s])[0]="number"==typeof i[0]?i[0]:M(i[0],n),i[1]="number"==typeof i[1]?i[1]:M(i[1],n),r.origin=i,t)"rotate"===o?r[o]="number"==typeof t[o]?t[o]:t[o]instanceof Array?t[o][0]:1*t[o].split(/\s/)[0]:"translate"===o?(e=t[o]instanceof Array?t[o]:/\,|\s/.test(t[o])?t[o].split(","):[t[o],0],r[o]=[1*e[0]||0,1*e[1]||0]):/skew/.test(o)?r[o]=1*t[o]||0:"scale"===o&&(r[o]=parseFloat(t[o])||1);return r};return a.svgTransform=function(t,e){return"svgTransform"in n||(n.svgTransform=function(t,e,r,n,a){var s,i=0,o=0,l=Math.PI/180,h="scale"in n?v(r.scale,n.scale,a):1,u="rotate"in n?v(r.rotate,n.rotate,a):0,p=Math.sin(u*l),g=Math.cos(u*l),f="skewX"in n?v(r.skewX,n.skewX,a):0,c="skewY"in n?v(r.skewY,n.skewY,a):0,m=u||f||c||1!==h||0;i-=m?n.origin[0]:0,o-=m?n.origin[1]:0,i*=h,o*=h,o+=c?i*Math.tan(c*l):0,s=g*(i+=f?o*Math.tan(f*l):0)-p*o,o=u?p*i+g*o:o,i=u?s:i,i+="translate"in n?v(r.translate[0],n.translate[0],a):0,o+="translate"in n?v(r.translate[1],n.translate[1],a):0,i+=m?n.origin[0]:0,o+=m?n.origin[1]:0,t.setAttribute("transform",(i||o?"translate("+(1e3*i>>0)/1e3+(o?","+(1e3*o>>0)/1e3:"")+")":"")+(u?"rotate("+(1e3*u>>0)/1e3+")":"")+(f?"skewX("+(1e3*f>>0)/1e3+")":"")+(c?"skewY("+(1e3*c>>0)/1e3+")":"")+(1!==h?"scale("+(1e3*h>>0)/1e3+")":""))}),k.call(this,e)},s.svgTransform=function(t,e){var r={},n=x(this.element.getAttribute("transform"));for(var a in e)r[a]=a in n?n[a]:"scale"===a?1:0;return r},i.svgTransform=function(){if(this.options.rpr){var t=this.valuesStart.svgTransform,e=this.valuesEnd.svgTransform,r=k.call(this,x(this.element.getAttribute("transform")));for(var n in r)t[n]=r[n];var a=this.element.ownerSVGElement,s=a.createSVGTransformFromMatrix(a.createSVGMatrix().translate(-t.origin[0],-t.origin[1]).translate("translate"in t?t.translate[0]:0,"translate"in t?t.translate[1]:0).rotate(t.rotate||0).skewX(t.skewX||0).skewY(t.skewY||0).scale(t.scale||1).translate(+t.origin[0],+t.origin[1]));for(var n in t.translate=[s.matrix.e,s.matrix.f],t)n in e||(e[n]=t[n])}},this}});